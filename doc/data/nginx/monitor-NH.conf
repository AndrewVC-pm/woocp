#server {
#    listen 80;
#    listen [::]:80;
#    server_name monitor.neuro-hub.pro;
#
#    location ^~ /.well-known/acme-challenge/ {
#        add_header X-Debug "login-acme" always;
#	root /var/www/certbot;
#        allow all;
#        default_type "text/plain";
#        try_files $uri =404;
#    }
#    location / {
#	return 301 https://$host$request_uri;
#    }
#   
#}

#upstream monitor_neuro_hub_pro {
#    server 192.168.100.108:7878;
#}

server {
    listen 80;
    listen [::]:80;
    server_name monitor.neuro-hub.pro;
    location ^~ /.well-known/acme-challenge/ {
        add_header X-Debug "login-acme" always;
	root /var/www/certbot;
        allow all;
        default_type "text/plain";
        try_files $uri =404;
    } 
   
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name monitor.neuro-hub.pro;
    ssl_certificate        /etc/letsencrypt/live/login.entire.vc/fullchain.pem;
    ssl_certificate_key    /etc/letsencrypt/live/login.entire.vc/privkey.pem;
    include		   /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam            /etc/letsencrypt/ssl-dhparams.pem;
    ssl_verify_depth 1;
#    ssl_session_cache shared:SSL:10m;
#    ssl_session_timeout 10m;
#    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
#    ssl_prefer_server_ciphers on;
#    ssl_ciphers ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH+3DES:DH+3DES:RSA+AESGCM:RSA+AES:RSA+3DES:!aNULL:!MD5:!DSS;

    location / {
	proxy_pass				http://127.0.0.1:7878;
        proxy_http_version	1.1;
        proxy_set_header    	Upgrade		$http_upgrade;
        proxy_set_header 	Connection	"upgrade";
        proxy_set_header 	Host 		monitor.neuro-hub.pro;
        proxy_buffering 	off;
        client_max_body_size 	0;
        proxy_connect_timeout  	3600s;
        proxy_read_timeout  	3600s;
        proxy_send_timeout  	3600s;
        send_timeout  		3600s;
    }

    # Letâ€™s Encrypt (certbot --manual --agree-tos --manual-public-ip-logging-ok --preferred-challenges http certonly --server https://acme-v02.api.letsencrypt.org/directory -d monitor.neuro-hub.pro)
#    location /.well-known/acme-challenge/j_FQwwe_KsiggtNvPIlSDQJOZBECGBJtIZghqj3jz9k {
#        default_type text/plain;
#        return 200 "j_FQwwe_KsiggtNvPIlSDQJOZBECGBJtIZghqj3jz9k._mEC2G7nB1EL9g8Qa4fB58ayVR1tSXeI5ZG_yk4WUbQ";
#    }
     location ^~ /.well-known/acme-challenge/ {
        add_header X-Debug "login-acme" always;
	root /var/www/certbot;
        allow all;
        default_type "text/plain";
        try_files $uri =404;
    }

}
